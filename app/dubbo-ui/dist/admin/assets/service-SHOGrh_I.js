import{d as T,v as V,a as A,u as D,r as d,W as M,l as P,c as f,Q as g,b as Q,w as c,n as h,P as b,R as E,e as t,o,G as v,f as y,t as S,J as $,K as x,y as O,_ as B}from"./index-hmLAZQYT.js";import{g as L,a as Y}from"./serverInfo-j8z5RY-E.js";import{S as F,a as J}from"./SearchUtil-sOWd6ofa.js";import{b as K}from"./app-duU6O0cq.js";import"./request-8jI_GZey.js";import{p as z,q as m}from"./PromQueryUtil-2EbGMcmH.js";const H={class:"__container_app_service"},W=T({__name:"service",setup(X){V(r=>({"28ddf99a":h(b)+"22","28a02396":h(b)}));const G=A(),I=D();let s=d({info:{},report:{}}),w=d({info:{}});M(async()=>{n.tableStyle={scrollX:"100",scrollY:"calc(100vh - 600px)"};let r=(await L({})).data;w.info=(await Y({})).data,s.info=r,s.report={providers:{icon:"carbon:branch",value:s.info.providers},consumers:{icon:"mdi:merge",value:s.info.consumers}}});const N=[{title:"provideServiceName",key:"service",dataIndex:"serviceName",sorter:!0,width:"30%"},{title:"versionGroup",key:"versionGroup",dataIndex:"versionGroupSelect",width:"25%"},{title:"avgQPS",key:"avgQPS",dataIndex:"avgQPS",sorter:!0,width:"15%"},{title:"avgRT",key:"avgRT",dataIndex:"avgRT",sorter:!0,width:"15%"},{title:"requestTotal",key:"requestTotal",dataIndex:"requestTotal",sorter:!0,width:"15%"}],k=P(()=>{var r;return(r=G.params)==null?void 0:r.pathId});function q(r){return K(r).then(async _=>z(_,["qps","rt","request"],async a=>{a.versionGroupSelect={},a.versionGroupSelect.versionGroupArr=a.versionGroups.map(e=>e.versionGroup=(e.version?"version: "+e.version+", ":"")+(e.group?"group: "+e.group:"")||"æ— "),a.versionGroupSelect.versionGroupValue=a.versionGroupSelect.versionGroupArr[0];let u=await m(`sum (dubbo_provider_qps_total{interface='${a.serviceName}'}) by (interface)`),l=await m(`avg(dubbo_consumer_rt_avg_milliseconds_aggregate{interface="${a.serviceName}",method=~"$method"}>0)`),i=await m(`sum (increase(dubbo_provider_requests_total{interface="${a.serviceName}"}[1m]))`);a.avgQPS=u,a.avgRT=l,a.requestTotal=i}))}const n=d(new F([{label:"serviceName",param:"serviceName"},{label:"",param:"appName",defaultValue:k}],q,N,{pageSize:4},!0));n.onSearch();const C=r=>{I.push("/resources/services/distribution/"+r)};return E(O.SEARCH_DOMAIN,n),(r,_)=>{t("a-statistic"),t("a-flex"),t("a-card");const a=t("a-button"),u=t("a-select-option"),l=t("a-select");return o(),f("div",H,[g("",!0),Q(J,{"search-domain":n},{bodyCell:c(({column:i,text:e})=>[i.dataIndex==="serviceName"?(o(),v(a,{key:0,type:"link",onClick:p=>C(e)},{default:c(()=>[y(S(e),1)]),_:2},1032,["onClick"])):i.dataIndex==="versionGroupSelect"?(o(),v(l,{key:1,value:e==null?void 0:e.versionGroupValue,bordered:!1,style:{width:"80%"}},{default:c(()=>[(o(!0),f($,null,x(e==null?void 0:e.versionGroupArr,(p,R)=>(o(),v(u,{value:p,key:R},{default:c(()=>[y(S(p),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value"])):g("",!0)]),_:1},8,["search-domain"])])}}}),te=B(W,[["__scopeId","data-v-42269320"]]);export{te as default};
