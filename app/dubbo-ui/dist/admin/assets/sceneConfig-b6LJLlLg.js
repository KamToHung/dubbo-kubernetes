import{b as o,A as q,d as H,e as p,o as m,c as D,w as a,j as J,t as O,n as E,a7 as X,J as M,K as T,f as I,G as b,Q as k,a6 as V,_ as L,a as Y,r as Z,W as K}from"./index-hmLAZQYT.js";import{C as ee}from"./ConfigPage--FZz2L2D.js";import{u as te,c as ae,d as oe,e as ne,f as re,h as ie,i as se,j as ue}from"./service-HiIVI9X0.js";import"./request-8jI_GZey.js";var le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"};const ce=le;function z(g){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?Object(arguments[i]):{},n=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(s).filter(function(w){return Object.getOwnPropertyDescriptor(s,w).enumerable}))),n.forEach(function(w){de(g,w,s[w])})}return g}function de(g,i,s){return i in g?Object.defineProperty(g,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):g[i]=s,g}var B=function(i,s){var n=z({},i,s.attrs);return o(q,z({},n,{icon:ce}),null)};B.displayName="MinusOutlined";B.inheritAttrs=!1;const G=B,me={class:"__container_services_tabs_param_route"},pe=H({__name:"paramRoute",props:{paramRouteForm:{type:Object,default:()=>{}},index:{type:Number}},emits:["deleteParamRoute"],setup(g,{emit:i}){const s=i,n=g,w=[{label:"getUserInfo",value:"getUserInfo"},{label:"register",value:"register"},{label:"login",value:"login"}],S=[{title:"参数索引",key:"index",dataIndex:"index",width:"30%"},{title:"关系",key:"relation",dataIndex:"relation",width:"30%"},{title:"值",key:"value",dataIndex:"value",width:"30%"},{title:"操作",key:"handle",dataIndex:"handle",width:"10%"}],x=[{title:"标签",key:"tag",dataIndex:"tag",width:"25%"},{title:"关系",key:"relation",dataIndex:"relation",width:"25%"},{title:"值",key:"value",dataIndex:"value",width:"25%"},{title:"操作",key:"handle",dataIndex:"handle",width:"10%"}],C=()=>{n.paramRouteForm.conditions.push({index:"",relation:"",value:""})},$=R=>{n.paramRouteForm.conditions.splice(R,1)},N=()=>{n.paramRouteForm.destinations.push({conditions:[{tag:"",relation:"",value:""}],weight:0})},j=R=>{n.paramRouteForm.destinations[R].conditions.push({tag:"",relation:"",value:""})},A=(R,e)=>{const{destinations:t}=n.paramRouteForm,r=t[R];if(r.conditions.length===1&&t.length>1){t.splice(R,1);return}r.conditions.length>1&&r.conditions.splice(e,1)};return(R,e)=>{const t=p("a-flex"),r=p("a-select-option"),u=p("a-select"),l=p("a-form-item"),c=p("a-button"),v=p("a-input"),f=p("a-table"),h=p("a-space"),U=p("a-card"),Q=p("a-form");return m(),D("div",me,[o(U,{bordered:!1,style:{width:"1000px"}},{title:a(()=>[o(t,{justify:"space-between"},{default:a(()=>[o(t,{align:"center",gap:8},{default:a(()=>[J("span",null,"路由"+O((n==null?void 0:n.index)+1),1),o(E(X),{onClick:e[0]||(e[0]=_=>s("deleteParamRoute",n.index)),class:"edit-icon"})]),_:1})]),_:1})]),default:a(()=>[o(Q,{labelCol:{span:3}},{default:a(()=>[o(l,{label:"选择方法"},{default:a(()=>[o(u,{value:n.paramRouteForm.method,"onUpdate:value":e[1]||(e[1]=_=>n.paramRouteForm.method=_),style:{width:"200px"}},{default:a(()=>[(m(),D(M,null,T(w,(_,d)=>o(r,{value:_.value,key:d},{default:a(()=>[I(O(_.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),o(l,{label:"指定方法参数"},{default:a(()=>[o(h,{direction:"vertical"},{default:a(()=>[o(c,{type:"primary",onClick:C},{default:a(()=>[I(" 添加参数 ")]),_:1}),o(f,{columns:S,"data-source":n.paramRouteForm.conditions,pagination:!1},{bodyCell:a(({column:_,index:d})=>[_.dataIndex==="index"?(m(),b(v,{key:0,value:n.paramRouteForm.conditions[d].index,"onUpdate:value":y=>n.paramRouteForm.conditions[d].index=y},null,8,["value","onUpdate:value"])):k("",!0),_.dataIndex==="relation"?(m(),b(v,{key:1,value:n.paramRouteForm.conditions[d].relation,"onUpdate:value":y=>n.paramRouteForm.conditions[d].relation=y},null,8,["value","onUpdate:value"])):k("",!0),_.dataIndex==="value"?(m(),b(v,{key:2,value:n.paramRouteForm.conditions[d].value,"onUpdate:value":y=>n.paramRouteForm.conditions[d].value=y},null,8,["value","onUpdate:value"])):k("",!0),_.dataIndex==="handle"?(m(),b(t,{key:3,justify:"space-between"},{default:a(()=>[o(E(G),{class:V(["edit-icon",{"disabled-icon":n.paramRouteForm.conditions.length===1}]),onClick:y=>n.paramRouteForm.conditions.length!==1&&$(d)},null,8,["class","onClick"])]),_:2},1024)):k("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1}),o(l,{label:"路由目的地"},{default:a(()=>[o(h,{direction:"vertical"},{default:a(()=>[o(c,{type:"primary",onClick:N},{default:a(()=>[I(" 添加目的地 ")]),_:1}),(m(!0),D(M,null,T(n.paramRouteForm.destinations,(_,d)=>(m(),b(U,{key:d,bordered:!1},{title:a(()=>[o(h,null,{default:a(()=>[I(" 目的地"+O(d+1)+" ",1),o(c,{type:"primary",onClick:y=>j(d)},{default:a(()=>[I(" 添加条件 ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[o(f,{columns:x,"data-source":_.conditions,pagination:!1},{bodyCell:a(({column:y,index:W,record:F})=>[y.dataIndex==="tag"?(m(),b(v,{key:0,value:F.tag,"onUpdate:value":P=>F.tag=P},null,8,["value","onUpdate:value"])):k("",!0),y.dataIndex==="relation"?(m(),b(v,{key:1,value:F.relation,"onUpdate:value":P=>F.relation=P},null,8,["value","onUpdate:value"])):k("",!0),y.dataIndex==="value"?(m(),b(v,{key:2,value:F.value,"onUpdate:value":P=>F.value=P},null,8,["value","onUpdate:value"])):k("",!0),y.dataIndex==="handle"?(m(),b(t,{key:3,justify:"space-between"},{default:a(()=>[o(E(G),{class:V([{"disabled-icon":n.paramRouteForm.destinations[d].conditions.length===1&&n.paramRouteForm.destinations.length===1},"edit-icon"]),onClick:P=>A(d,W)},null,8,["class","onClick"])]),_:2},1024)):k("",!0)]),_:2},1032,["data-source"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ve=L(pe,[["__scopeId","data-v-64cbfabd"]]),fe={class:"container-services-tabs-scene-config"},_e={class:"param-route"},ye=H({__name:"sceneConfig",setup(g){const i=Y(),s=Z({list:[{title:"serviceDomain.timeout",key:"timeout",form:{timeout:1e3},submit:e=>new Promise(t=>{t($(e==null?void 0:e.timeout))}),async reset(e){await C()}},{title:"serviceDomain.retryNum",key:"retryNum",form:{retryNum:0},submit:e=>new Promise(t=>{t(j(e==null?void 0:e.retryNum))}),async reset(e){await N()}},{title:"serviceDomain.sameAreaFirst",key:"sameAreaFirst",form:{sameAreaFirst:!1},submit:e=>new Promise(t=>{t(R(e==null?void 0:e.sameAreaFirst))}),async reset(e){await A()}},{title:"serviceDomain.paramRoute",key:"paramRoute",form:{paramRoute:[]},submit:e=>new Promise(t=>{t(w(e==null?void 0:e.paramRoute))}),reset(e){return new Promise(t=>{t(x())})}}],current:[0]}),n=()=>{s.list.forEach(e=>{if(e.key==="paramRoute"){const t={method:"string",conditions:[{index:"string",relation:"string",value:"string"}],destinations:[{conditions:[{tag:"string",relation:"string",value:"string"}],weight:0}]};e.form.paramRoute.push(t)}})},w=async()=>{const{pathId:e,group:t,version:r}=i.params;s.list.forEach(async u=>{u.key==="paramRoute"&&(await te({serviceName:e,group:t||"",version:r||"",routes:u.form.paramRoute}),await x())})},S=e=>{s.list.forEach(t=>{t.key==="paramRoute"&&t.form.paramRoute.splice(e,1)})},x=async()=>{const{pathId:e,group:t,version:r}=i.params,l=await ae({serviceName:e,group:t,version:r});l.code===200&&s.list.forEach(c=>{var v;c.key==="paramRoute"&&(c.form.paramRoute=(v=l.data)==null?void 0:v.routes)})},C=async()=>{const{pathId:e,group:t,version:r}=i.params,l=await oe({serviceName:e,group:t||"",version:r||""});s.list.forEach(c=>{c.key==="timeout"&&(c.form.timeout=l.data.timeout)})},$=async e=>{const{pathId:t,group:r,version:u}=i.params;await ne({serviceName:t,group:r||"",version:u||"",timeout:e}),await C()},N=async()=>{const{pathId:e,group:t,version:r}=i.params,l=await re({serviceName:e,group:t||"",version:r||""});s.list.forEach(c=>{c.key==="retryNum"&&(c.form.retryNum=l.data.retryTimes)})},j=async e=>{const{pathId:t,group:r,version:u}=i.params;await ie({serviceName:t,group:r||"",version:u||"",retryTimes:e}),await N()},A=async()=>{const{pathId:e,group:t,version:r}=i.params,l=await se({serviceName:e,group:t||"",version:r||""});s.list.forEach(c=>{var v;c.key==="sameAreaFirst"&&(c.form.sameAreaFirst=(v=l.data)==null?void 0:v.enabled)})},R=async e=>{const{pathId:t,group:r,version:u}=i.params;await ue({serviceName:t,group:r||"",version:u||"",enabled:e}),await A()};return K(async()=>{await C(),await N(),await A(),await x()}),(e,t)=>{const r=p("a-input-number"),u=p("a-form-item"),l=p("a-radio-button"),c=p("a-radio-group"),v=p("a-button");return m(),D("div",fe,[o(ee,{options:s},{form_timeout:a(({current:f})=>[o(u,{label:e.$t("serviceDomain.timeout"),name:"timeout"},{default:a(()=>[o(r,{value:f.form.timeout,"onUpdate:value":h=>f.form.timeout=h,"addon-after":"ms",style:{width:"150px"}},null,8,["value","onUpdate:value"])]),_:2},1032,["label"])]),form_retryNum:a(({current:f})=>[o(u,{label:e.$t("serviceDomain.retryNum"),name:"retryNum"},{default:a(()=>[o(r,{value:f.form.retryNum,"onUpdate:value":h=>f.form.retryNum=h,"addon-after":"次",style:{width:"150px"}},null,8,["value","onUpdate:value"])]),_:2},1032,["label"])]),form_sameAreaFirst:a(({current:f})=>[o(u,{label:e.$t("serviceDomain.sameAreaFirst"),name:"sameAreaFirst"},{default:a(()=>[o(c,{value:f.form.sameAreaFirst,"onUpdate:value":h=>f.form.sameAreaFirst=h,"button-style":"solid"},{default:a(()=>[o(l,{value:!1},{default:a(()=>[I(O(e.$t("serviceDomain.closed")),1)]),_:1}),o(l,{value:!0},{default:a(()=>[I(O(e.$t("serviceDomain.opened")),1)]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["label"])]),form_paramRoute:a(({current:f})=>[o(u,{name:"paramRoute"},{default:a(()=>[J("div",_e,[(m(!0),D(M,null,T(f.form.paramRoute,(h,U)=>(m(),b(ve,{key:U,paramRouteForm:h,index:U,onDeleteParamRoute:S},null,8,["paramRouteForm","index"]))),128)),o(v,{type:"primary",style:{"margin-top":"20px"},onClick:n},{default:a(()=>[I("增加路由")]),_:1})])]),_:2},1024)]),_:1},8,["options"])])}}}),we=L(ye,[["__scopeId","data-v-c8bd54d9"]]);export{we as default};
