import{y as V,_ as L}from"./js-yaml-8Gkz3BRW.js";import{d as R,a as K,z as r,x as P,y as q,W as z,l as G,r as N,u as Q,c as D,b as a,w as e,G as O,Q as b,J as B,e as d,o as y,j as I,K as U,f as v,m as g,a3 as W,p as $,h as H,_ as X}from"./index-hmLAZQYT.js";import{k as Z,l as aa,m as ea}from"./traffic-C2a-KjHH.js";import{V as ta}from"./ConfigModel-QFNd-Zdd.js";import"./request-8jI_GZey.js";const S=m=>($("data-v-68fde8b4"),m=m(),H(),m),sa={class:"editorBox"},na=S(()=>I("p",null,"修改时间: 2024/3/20 15:20:31",-1)),oa=S(()=>I("p",null,"版本号: xo842xqpx834",-1)),la=R({__name:"YAMLView",setup(m){const _=K(),C=r(_.params.isEdit==="1"),h=r(!1),f=r(!1),A=r(8),p=P(q.PROVIDE_INJECT_KEY),u=r(),k=r(),T=r("");z(async()=>{await E()}),G(()=>k.value!==JSON.stringify(u.value));const t=N(new ta);async function E(){var s,l,i;if((s=p.dynamicConfigForm)!=null&&s.data)t.fromData(p.dynamicConfigForm.data);else{if(((l=_.params)==null?void 0:l.pathId)==="_tmp")C.value=!0,t.isAdd=!0;else{t.isAdd=!1;const c=await Z({name:(i=_.params)==null?void 0:i.pathId});t.fromApiOutput(c.data)}p.dynamicConfigForm=N({data:t})}const n=t.toApiInput();T.value=n.ruleName,n.ruleName=void 0;const o=V.dump(n);k.value=JSON.stringify(o),u.value=o}async function F(){f.value=!0;try{p.dynamicConfigForm.data=null,await E(),g.success("config reset success")}finally{f.value=!1}}const j=Q();async function J(){var o;f.value=!0;let n=V.load(u.value);try{if(t.isAdd===!0){aa({name:t.basicInfo.key+".configurators"},n).then(l=>{p.dynamicConfigForm.data=null,W(()=>{j.replace("/traffic/dynamicConfig"),g.success("config add success")})}).catch(l=>{g.error("添加失败： "+l.msg)});return}let s=await ea({name:(o=_.params)==null?void 0:o.pathId},n);t.fromApiOutput(s.data),g.success("config save success")}finally{f.value=!1}}function M(n){t.fromApiOutput(V.load(u.value))}return(n,o)=>{const s=d("a-col"),l=d("a-row"),i=d("a-flex"),c=d("a-button"),x=d("a-card"),Y=d("a-spin");return y(),D(B,null,[a(x,null,{default:e(()=>[a(Y,{spinning:f.value},{default:e(()=>[a(i,{style:{width:"100%"}},{default:e(()=>[a(s,{span:h.value?24-A.value:24,class:"left"},{default:e(()=>[a(i,{vertical:"",align:"end"},{default:e(()=>[a(l,{style:{width:"100%"},justify:"space-between"},{default:e(()=>[a(s,{span:12}),a(s,{span:12})]),_:1}),I("div",sa,[a(L,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=w=>u.value=w),onChange:M,theme:"vs-dark",height:"calc(100vh - 450px)",language:"yaml",readonly:!C.value},null,8,["modelValue","readonly"])])]),_:1})]),_:1},8,["span"]),a(s,{span:h.value?A.value:0,class:"right"},{default:e(()=>[h.value?(y(),O(x,{key:0,class:"sliderBox"},{default:e(()=>[(y(),D(B,null,U(2,w=>a(x,{key:w},{default:e(()=>[na,oa,a(i,{justify:"flex-end"},{default:e(()=>[a(c,{type:"text",style:{color:"#0a90d5"}},{default:e(()=>[v("查看")]),_:1}),a(c,{type:"text",style:{color:"#0a90d5"}},{default:e(()=>[v("回滚")]),_:1})]),_:1})]),_:2},1024)),64))]),_:1})):b("",!0)]),_:1},8,["span"])]),_:1})]),_:1},8,["spinning"])]),_:1}),C.value?(y(),O(i,{key:0,style:{"margin-top":"30px"}},{default:e(()=>[a(c,{type:"primary",onClick:J},{default:e(()=>[v("保存")]),_:1}),a(c,{style:{"margin-left":"30px"},onClick:F},{default:e(()=>[v("重置")]),_:1})]),_:1})):b("",!0)],64)}}}),fa=X(la,[["__scopeId","data-v-68fde8b4"]]);export{fa as default};
